---
/**
 * ReviewCard Molecule
 * Hunter Galloway Design System - Molecular Component
 * 
 * Composes Avatar, StarRating, and Typography atoms to create customer review cards.
 * Follows atomic design principles with proper component composition.
 */

import type { ReviewCardProps } from './ReviewCard.types';
import Avatar from '../../atoms/Avatar/Avatar.astro';
import StarRating from '../../atoms/StarRating/StarRating.astro';
import Typography from '../../atoms/Typography/Typography.astro';
import { semantic } from '../../../tokens/semantic';

interface Props extends ReviewCardProps {}

const {
  name,
  image,
  text,
  rating = 5,
  isExpanded = false,
  hasReadMore = false,
  className = '',
} = Astro.props;

// Check if text needs truncation (rough estimation - WordPress uses line-3 class)
const needsReadMore = text.length > 180;
const shouldShowReadMore = hasReadMore && needsReadMore;

// Build CSS classes using design tokens
const cardClasses = [
  'hg-review-card',
  className,
].filter(Boolean).join(' ');

const textClasses = [
  'hg-review-card__text',
  needsReadMore && !isExpanded ? 'hg-review-card__text--truncated' : '',
].filter(Boolean).join(' ');

const readMoreClasses = [
  'hg-review-card__read-more',
  !needsReadMore ? 'hg-review-card__read-more--hidden' : '',
].filter(Boolean).join(' ');
---

<div class={`${cardClasses} swiper-slide`}>
  <Avatar 
    src={image} 
    alt={name} 
    size="lg" 
    bordered={true}
    class="hg-review-card__avatar"
  />
  
  <Typography 
    element="p" 
    size="lg" 
    weight="strong"
    class="hg-review-card__name"
  >
    {name}
  </Typography>
  
  <div class="hg-review-card__content">
    <Typography 
      element="p" 
      size="sm" 
      class={textClasses}
    >
      {text}
    </Typography>
    
    {shouldShowReadMore && (
      <a class={readMoreClasses}>
        <span class="hg-review-card__read-more-text">... <span>Read more</span></span>
        <span class="hg-review-card__read-less-text">Show less</span>
      </a>
    )}
  </div>
  
  <StarRating 
    rating={rating} 
    size="md"
    class="hg-review-card__rating"
  />
</div>

<style define:vars={{
  surfacePrimary: semantic.color.surface.primary,
  borderPrimary: semantic.color.border.primary,
  textPrimary: semantic.color.text.primary,
  textSecondary: semantic.color.text.secondary,
  brandPrimary: semantic.color.brand.primary,
  brandPrimaryHover: semantic.color.brand.primaryHover,
  fontSizeSm: semantic.typography.size.sm,
  fontSizeLg: semantic.typography.size.lg,
  fontWeightStrong: semantic.typography.weight.strong,
  fontWeightEmphasis: semantic.typography.weight.emphasis,
  lineHeightBody: semantic.typography.lineHeight.body,
  lineHeightTight: semantic.typography.lineHeight.tight,
  spaceSm: semantic.space.sm,
  spaceMd: semantic.space.md,
  spaceLg: semantic.space.lg,
  radiusMd: semantic.radius.md,
  shadowCard: semantic.shadow.card,
  durationNormal: semantic.duration.normal,
}}}>
/* ReviewCard component styles using design tokens */
.hg-review-card {
  background: var(--surfacePrimary);
  border-radius: var(--radiusMd);
  padding: var(--spaceLg) var(--spaceMd);
  text-align: center;
  min-height: 280px;
  display: flex;
  flex-direction: column;
  position: relative;
  border: 1px solid var(--borderPrimary);
  transition: transform var(--durationNormal) ease;
}

.hg-review-card:hover {
  transform: translateY(-2px);
  box-shadow: var(--shadowCard);
}

.hg-review-card__avatar {
  margin: 0 auto var(--spaceSm) auto;
}

.hg-review-card__name {
  margin: 0 0 var(--spaceSm) 0;
}

.hg-review-card__content {
  flex: 1;
  margin-bottom: var(--spaceSm);
}

.hg-review-card__text {
  margin: 0 0 calc(var(--spaceSm) * 0.75) 0;
  text-align: left;
}

.hg-review-card__text--truncated {
  display: -webkit-box;
  -webkit-line-clamp: 3;
  -webkit-box-orient: vertical;
  overflow: hidden;
  text-overflow: ellipsis;
}

.hg-review-card__read-more {
  font-size: var(--fontSizeSm);
  color: var(--brandPrimary);
  text-decoration: none;
  cursor: pointer;
  font-weight: var(--fontWeightEmphasis);
  display: inline-block;
  margin-top: calc(var(--spaceSm) * 0.5);
}

.hg-review-card__read-more:hover {
  color: var(--brandPrimaryHover);
  text-decoration: underline;
}

.hg-review-card__read-less-text {
  display: none;
}

.hg-review-card__read-more.expanded .hg-review-card__read-more-text {
  display: none;
}

.hg-review-card__read-more.expanded .hg-review-card__read-less-text {
  display: inline;
}

.hg-review-card__read-more--hidden {
  display: none !important;
}

.hg-review-card__rating {
  justify-content: center;
  margin-top: auto;
}

/* Responsive design using semantic tokens */
@media (max-width: 768px) {
  .hg-review-card {
    padding: var(--spaceMd) var(--spaceSm);
    min-height: 300px;
  }
}
</style>